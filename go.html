<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <title>リダイレクト中...</title>
  <style>
    body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background: #f8f9fa; }
    .loading { text-align: center; color: #64748b; }
  </style>
</head>
<body>
  <div class="loading"><p>リダイレクト中...</p></div>
  <script>
  (function() {
    var id = new URLSearchParams(location.search).get('id');
    if (!id) { location.href = 'index.html'; return; }

    try {
      var clicks = JSON.parse(localStorage.getItem('affiliateClicks') || '{}');
      clicks[id] = (clicks[id] || 0) + 1;
      clicks._total = (clicks._total || 0) + 1;
      clicks._last = new Date().toISOString();
      localStorage.setItem('affiliateClicks', JSON.stringify(clicks));
    } catch(e) {}

    if (typeof gtag === 'function') {
      gtag('event', 'affiliate_click', { product_id: id });
    }

    fetch('data/sites.json')
      .then(function(r) { return r.json(); })
      .then(function(data) {
        var premium = data.premiumSites || [];
        var item = premium.find(function(p) { return p.id === id; });
        if (item) {
          var url = item.affiliateUrl || item.url;
          if (url) { location.href = url; return; }
        }
        location.href = 'index.html';
      })
      .catch(function() { location.href = 'index.html'; });
  })();
  </script>
</body>
</html>
